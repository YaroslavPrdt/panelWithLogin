{"ast":null,"code":"import uniq from 'lodash/uniq';\nimport { CRUD_GET_LIST_SUCCESS, CRUD_DELETE_OPTIMISTIC, CRUD_DELETE_MANY_OPTIMISTIC, CRUD_GET_MANY_SUCCESS, CRUD_GET_MANY_REFERENCE_SUCCESS, CRUD_GET_ONE_SUCCESS, CRUD_CREATE_SUCCESS, CRUD_UPDATE_SUCCESS } from '../../../../actions/dataActions';\nimport getFetchedAt from '../../../../util/getFetchedAt';\nexport var addRecordIdsFactory = function addRecordIdsFactory(getFetchedAt) {\n  return function (newRecordIds, oldRecordIds) {\n    if (newRecordIds === void 0) {\n      newRecordIds = [];\n    }\n\n    var newFetchedAt = getFetchedAt(newRecordIds, oldRecordIds.fetchedAt);\n    var recordIds = uniq(oldRecordIds.filter(function (id) {\n      return !!newFetchedAt[id];\n    }).concat(newRecordIds));\n    Object.defineProperty(recordIds, 'fetchedAt', {\n      value: newFetchedAt\n    }); // non enumerable by default\n\n    return recordIds;\n  };\n};\nvar addRecordIds = addRecordIdsFactory(getFetchedAt);\nexport default (function (previousState, _a) {\n  if (previousState === void 0) {\n    previousState = [];\n  }\n\n  var type = _a.type,\n      payload = _a.payload;\n\n  switch (type) {\n    case CRUD_GET_LIST_SUCCESS:\n      return addRecordIds(payload.data.map(function (_a) {\n        var id = _a.id;\n        return id;\n      }), []);\n\n    case CRUD_GET_MANY_SUCCESS:\n    case CRUD_GET_MANY_REFERENCE_SUCCESS:\n      return addRecordIds(payload.data.map(function (_a) {\n        var id = _a.id;\n        return id;\n      }).filter(function (id) {\n        return previousState.indexOf(id) !== -1;\n      }), previousState);\n\n    case CRUD_GET_ONE_SUCCESS:\n    case CRUD_CREATE_SUCCESS:\n    case CRUD_UPDATE_SUCCESS:\n      return addRecordIds([payload.data.id], previousState);\n\n    case CRUD_DELETE_OPTIMISTIC:\n      {\n        var index = previousState.map(function (el) {\n          return el == payload.id;\n        }) // eslint-disable-line eqeqeq\n        .indexOf(true);\n\n        if (index === -1) {\n          return previousState;\n        }\n\n        var newState = previousState.slice(0, index).concat(previousState.slice(index + 1));\n        Object.defineProperty(newState, 'fetchedAt', {\n          value: previousState.fetchedAt\n        });\n        return newState;\n      }\n\n    case CRUD_DELETE_MANY_OPTIMISTIC:\n      {\n        var newState = previousState.filter(function (el) {\n          return !payload.ids.includes(el);\n        });\n        Object.defineProperty(newState, 'fetchedAt', {\n          value: previousState.fetchedAt\n        });\n        return newState;\n      }\n\n    default:\n      return previousState;\n  }\n});\nexport var getIds = function getIds(state) {\n  return state;\n};","map":null,"metadata":{},"sourceType":"module"}